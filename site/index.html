<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema Petrobras - Quest√µes & Flashcards</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/header.css">
    <link rel="stylesheet" href="assets/css/flash-cards.css">
    <link rel="stylesheet" href="assets/css/ler-pdf.css">
    <link rel="stylesheet" href="assets/css/secao-praticar.css">
    <link rel="stylesheet" href="assets/css/secao-banco.css">
</head>

<body>
    <div id="loader-overlay">
        <div class="spinner"></div>
        <div id="loader-msg">Processando...</div>
    </div>

    <header id="main-header">
        <div class="container flex">
            <div class="logo">
                <h4>Concurso Petrobras</h4>
            </div>
            <nav>
                <button id="nav-cadastro" onclick="nav('cadastro')">Cadastrar</button>
                <button id="nav-banco" onclick="nav('banco')">Banco</button>
                <button id="nav-praticar" onclick="nav('praticar')">Praticar</button>
                <button id="nav-prova" onclick="nav('prova')" style="color:#f1c40f;border-color:#f1c40f">Simulado
                    Real</button>
                <button id="nav-flashcards" onclick="nav('flashcards')">üóÇÔ∏è Flashcards</button>
                <button id="nav-estatisticas" onclick="nav('estatisticas')">Estat√≠sticas</button>
                <button id="nav-importar" onclick="nav('importar')">üìÇ Importar PDF</button>
            </nav>
        </div>
    </header>

    <div id="floating-toolbar" class="floating-toolbar">
        <button onmousedown="event.preventDefault(); fmtUlt('b')" title="Negrito">B</button>
        <button onmousedown="event.preventDefault(); fmtUlt('i')" title="It√°lico">I</button>
        <button onmousedown="event.preventDefault(); fmtUlt('u')" title="Sublinhado">U</button>
        <button onmousedown="event.preventDefault(); fmtUlt('mark')" title="Destaque">üñç</button>
    </div>

    <datalist id="lista-bancas"></datalist>
    <datalist id="lista-instituicoes"></datalist>
    <datalist id="lista-disciplinas"></datalist>
    <datalist id="lista-assuntos"></datalist>

    <section id="secao-cadastro" class="secao">
        <div class="container">
            <h2>Cadastrar Quest√£o</h2>
            <form id="form-cadastro">
                <div class="input-group" style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #fdfdfd;">
                    <label style="font-weight:bold; color:var(--primary)">Texto de Apoio (Opcional)</label>
                    <div style="display:flex; gap:10px;">
                        <select class="sel-texto-apoio" style="flex-grow:1;">
                            <option selected value="">-- Sem Texto de Apoio --</option>
                            </select>
                        <button type="button" class="btn-padrao" onclick="abrirModalTexto()">+ Novo Texto</button>
                    </div>
                    <div class="preview-texto-apoio" style="font-size:0.8em; color:#666; margin-top:5px; max-height:60px; overflow:hidden; font-style:italic;"></div>
                </div>
                <label>Enunciado:</label><textarea id="cad-enunciado" class="input-com-toolbar" rows="4" required
                    onfocus="showToolbar(this)"></textarea>
                <label>Imagem (Opcional):</label><input type="file" id="cad-imagem" accept="image/*">
                <div class="filtro-grid">
                    <input type="text" id="cad-banca" list="lista-bancas" placeholder="Banca (Selecione ou Digite)"
                        required>
                    <input type="text" id="cad-instituicao" list="lista-instituicoes" placeholder="Institui√ß√£o">
                    <input type="number" id="cad-ano" placeholder="Ano">
                    <input type="text" id="cad-disciplina" list="lista-disciplinas" placeholder="Disciplina" required
                        onchange="carregarAssuntos('cad')">
                </div>
                <div class="filtro-grid">
                    <input type="text" id="cad-assunto" list="lista-assuntos"
                        placeholder="Assunto (Digite ou Selecione)" required>
                    <select id="cad-dificuldade">
                        <option>F√°cil</option>
                        <option selected>M√©dio</option>
                        <option>Dif√≠cil</option>
                    </select>
                </div>
                <select id="cad-tipo" onchange="altTipo('cad')">
                    <option value="ME">M√∫ltipla Escolha</option>
                    <option value="CE">Certo/Errado</option>
                </select>
                <div id="cad-container-alt">
                    <div class="input-group"><span>A)</span><input type="text" id="cad-alt-a"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>B)</span><input type="text" id="cad-alt-b"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>C)</span><input type="text" id="cad-alt-c"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>D)</span><input type="text" id="cad-alt-d"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>E)</span><input type="text" id="cad-alt-e"
                            onfocus="showToolbar(this)"></div>
                </div>
                <label>Gabarito:</label><select id="cad-gabarito" required></select><button type="submit"
                    class="btn-acao">Salvar</button>
            </form>
        </div>
    </section>

    <section id="secao-importar" class="secao">
        <div class="container">
            <h2>Importar de PDF</h2>
            <div id="area-drop" class="filtro-grid"
                style="background:#f9f9f9; padding:25px; border-radius:6px; margin-bottom:20px; position:relative;">
                <div id="msg-drop"
                    style="position:absolute; top:-15px; left:50%; transform:translateX(-50%); background:#27ae60; color:white; padding:2px 10px; border-radius:4px; font-size:0.8rem;">
                    Solte o arquivo aqui!</div>
                <div style="grid-column: span 2; display: flex; gap: 10px; align-items: center;">
                    <input type="file" id="imp-file" accept="application/pdf" style="background:#fff; width:100%">
                    <button class="btn-acao" onclick="lerPDF()"
                        style="margin:5px 0; width:150px; background:#27ae60">Ler PDF</button>
                </div>
                <input type="text" id="imp-disciplina" list="lista-disciplinas" placeholder="Disciplina Padr√£o"
                    onchange="carregarAssuntos('imp')">
                <input type="text" id="imp-assunto" oninput="aplicarAssuntoGlobal()" list="lista-assuntos" placeholder="Assunto Global...">
            </div>
            <div id="imp-preview-container" style="display:none">
                <h3 id="imp-titulo-preview">Pr√©via</h3>
                <button class="btn-acao" onclick="salvarLote()" style="margin-bottom:15px;">üíæ Salvar Todas no
                    Banco</button>
                <div class="preview-header">
                    <div style="width:40px">#</div>
                    <div style="width:150px; margin-right:10px">Banca/Ano</div>
                    <div style="flex-grow:1">Enunciado / Alternativas (Edit√°vel)</div>
                    <div style="width:60px; text-align:center">Gab</div>
                    <div style="width:60px; text-align:center">A√ß√µes</div>
                </div>
                <div id="imp-lista-questoes"
                    style="background:#f4f4f9; padding:10px; max-height:600px; overflow-y:auto; border:1px solid #ccc">
                </div>
            </div>
        </div>
    </section>

    <section id="secao-banco" class="secao">
        <div class="container">
            <div class="flex">
                <h2>Banco de Quest√µes</h2><span id="total-db" style="color:#777"></span>
            </div>
            <div class="filtro-grid" style="background:#f9f9f9;padding:10px;border-radius:6px">
                <input type="text" id="busca-texto" placeholder="Buscar..." onkeyup="filtrar()">
                <select id="busca-disciplina" onchange="carregarAssuntos('busca'); filtrar()"></select>
                <select id="busca-assunto" onchange="filtrar()">
                    <option value="">Todos Assuntos</option>
                </select>
                <select id="busca-banca" onchange="filtrar()"></select>
                <select id="busca-instituicao" onchange="filtrar()">
                    <option value="">Institui√ß√£o...</option>
                </select>
                <select id="busca-dificuldade" onchange="filtrar()">
                    <option value="">Dif.</option>
                    <option>F√°cil</option>
                    <option>M√©dio</option>
                    <option>Dif√≠cil</option>
                </select>
            </div>
            <div style="overflow-x:auto">
                <table id="tabela-questoes">
                    <thead>
                        <tr>
                            <th width="40" onclick="ord('id')">ID</th>
                            <th width="90">Banca</th>
                            <th width="90">Inst.</th>
                            <th width="50">Ano</th>
                            <th width="100">Disc.</th>
                            <th>Enunciado</th>
                            <th width="100">Assunto</th>
                            <th width="50">Dif</th>
                            <th width="40">Gab</th>
                            <th width="60">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="paginacao-container" style="display:flex; justify-content:center; align-items:center; margin-top:20px; gap:10px"></div>
        </div>
    </section>

    <section id="secao-flashcards" class="secao">
        <div class="container">
            <div class="flex" style="margin-bottom: 20px;">
                <h2>üóÇÔ∏è Flashcards</h2>
                <div><button class="btn-acao" style="width:auto; background:#3498db; margin:0 5px"
                        onclick="toggleModeFC('estudo')">üéì Modo Estudo</button><button class="btn-acao"
                        style="width:auto; background:#95a5a6; margin:0" onclick="toggleModeFC('gerenciar')">‚úèÔ∏è
                        Gerenciar</button></div>
            </div>
            <div id="fc-modo-gerenciar" style="display:none">
                <div class="fc-layout">
                    <div>
                        <h4>Cart√µes Existentes</h4><input type="text" id="fc-filtro-ger"
                            placeholder="Filtrar por texto..." onkeyup="renderListaFC()">
                        <div id="fc-lista" class="fc-lista"></div>
                    </div>
                    <div style="background:#fafafa; padding:20px; border-radius:8px; border:1px solid #eee">
                        <h4 id="fc-titulo-form">Novo Cart√£o</h4>
                        <form id="fc-form"><input type="hidden" id="fc-id">
                            <label>Disciplina:</label><input type="text" id="fc-disciplina" list="lista-disciplinas"
                                required onchange="carregarAssuntos('fc')">
                            <label>Assunto:</label><input type="text" id="fc-assunto" list="lista-assuntos" required>
                            <label>Frente (Pergunta):</label><textarea id="fc-frente" rows="3" class="input-com-toolbar"
                                required onfocus="showToolbar(this)"></textarea><label>Verso
                                (Resposta):</label><textarea id="fc-verso" rows="4" class="input-com-toolbar" required
                                onfocus="showToolbar(this)"></textarea>
                            <div class="flex" style="margin-top:10px"><button type="button" class="btn-acao"
                                    style="background:#95a5a6; width:auto"
                                    onclick="limparFormFC()">Cancelar</button><button type="submit" class="btn-acao"
                                    style="width:auto">Salvar Cart√£o</button></div>
                        </form>
                    </div>
                </div>
            </div>
            <div id="fc-modo-estudo" style="display:none">
                <div class="filtro-grid" style="justify-content:center; max-width:800px; margin:0 auto">
                    <select id="fc-estudo-disc" onchange="carregarAssuntos('fc-estudo')"></select>
                    <select id="fc-estudo-assunto">
                        <option value="">Todos Assuntos</option>
                    </select>
                    <button class="btn-acao" style="margin:5px 0" onclick="iniciarEstudoFC()">Iniciar Revis√£o</button>
                </div>
                <div id="fc-area-jogo" style="display:none; text-align:center">
                    <h3 id="fc-progresso"></h3>
                    <div class="flip-card-container" id="card-ativo" onclick="virarCarta()">
                        <div class="flip-card-inner">
                            <div id="alfinetes" class="alfinetes"></div>
                            <div class="flip-card-front">
                                <span class="fc-tag" id="fc-front-tag"></span>
                                <div id="fc-front-content"></div>
                                <span style="font-size:0.8rem; color:#999; margin-top:20px">(Clique para virar)</span>
                            </div>
                            <div class="flip-card-back">
                                <div id="fc-back-content"></div>
                            </div>
                        </div>
                    </div>
                    <div id="fc-botoes" class="fc-botoes-resposta"><button class="btn-acao"
                            style="background:#e74c3c; width:120px" onclick="respFC(false)">Errei üòì</button><button
                            class="btn-acao" style="background:#27ae60; width:120px" onclick="respFC(true)">Acertei
                            ü§©</button></div>
                </div>
            </div>
        </div>
    </section>

    <section id="secao-praticar" class="secao">
        <div class="container">
            <h2>Praticar</h2>
            <div id="config-pratica">
                <div class="filtro-grid">
                    <select id="prat-disciplina" onchange="carregarAssuntos('prat')"></select>
                    <select id="prat-assunto">
                        <option value="">Todos Assuntos</option>
                    </select>
                    <select id="prat-banca">
                        <option value="">Todas as Bancas</option>
                    </select>
                    <input type="number" id="prat-qtd" value="10" placeholder="Qtd">
                </div>
                <button class="btn-acao" onclick="iniciarPratica()">Come√ßar Pr√°tica</button>
            </div>
            <div id="area-pratica" style="display:none">
                <div class="flex">
                    <h3 id="prat-progresso"></h3>
                    <button onclick="cancelarPratica()"
                        style="background:#e74c3c; border:none; color:white; padding:5px 10px; border-radius:4px; cursor:pointer;">Sair</button>
                </div>
                <div class="questao-card">
                    <div class="info-questao" id="prat-meta"></div>
                    <div class="enunciado render-html" id="prat-enunciado"></div>
                    <div id="prat-alternativas"></div>
                </div>
                <button id="prat-btn-confirma" class="btn-acao" onclick="confirmaPratica()">Confirmar</button>
                <button id="prat-btn-prox" class="btn-acao" onclick="proxPratica()"
                    style="display:none">Pr√≥xima</button>
                <div id="prat-feedback" style="margin-top:15px; font-weight:bold; padding:10px; border-radius:4px;">
                </div>
            </div>
        </div>
    </section>

    <section id="secao-prova" class="secao">
        <div class="container">
            <h2>Simulado Real</h2>
            <div id="config-prova">
                <div class="filtro-grid">
                    <div><label>Total:</label><input type="number" id="prova-total" value="10" min="1"
                            onchange="prepProva();"></div>
                    <div><label>Tempo (min):</label><input type="number" id="prova-tempo" value="30" min="1"></div>
                </div>
                <div id="lista-distribuicao"
                    style="background:#f9f9f9; padding:10px; border-radius:6px; margin-bottom:10px;"></div>
                <div id="total-porc" style="text-align:right; font-weight:bold;">Total: 0%</div><button class="btn-acao"
                    onclick="iniciarProva()">Iniciar Prova</button>
            </div>
            <div id="area-prova" style="display:none">
                <div id="barra-tempo-container">
                    <div id="barra-tempo-fill"></div>
                </div>
                <div class="flex">
                    <h3 id="prova-progresso"></h3><span id="prova-timer"
                        style="font-weight:bold; color:var(--acc)">00:00</span>
                </div>
                <div class="questao-card">
                    <div class="info-questao" id="prova-meta"></div>
                    <div class="enunciado render-html" id="prova-enunciado"></div>
                    <div id="prova-alternativas"></div>
                </div><button class="btn-acao" onclick="proxProva()">Pr√≥xima / Finalizar</button>
            </div>
            <div id="resultado-prova" style="display:none; text-align:center;">
                <h2>Resultado</h2>
                <div style="font-size:3em; font-weight:bold; color:var(--primary)" id="nota-prova"></div>
                <p id="msg-prova"></p>
                <div id="detalhes-prova" style="text-align:left; margin-top:20px;"></div><button class="btn-acao"
                    onclick="prepProva(); nav('prova');">Novo Simulado</button>
            </div>
        </div>
    </section>

    <section id="secao-estatisticas" class="secao">
        <div class="container">
            <div class="flex" style="justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="titulo-estatistica">Desempenho Geral</h2>
                <button id="btn-voltar-estatistica" class="btn-acao" onclick="graf()" 
                        style="display:none; width:auto; background:#95a5a6; padding: 5px 15px;">
                    ‚¨Ö Voltar para Disciplinas
                </button>
            </div>
            <canvas id="chart"></canvas>
        </div>
    </section>

    <div id="modal-edicao" class="modal">
        <div class="modal-content"><span class="close-modal"
                onclick="el('modal-edicao').style.display='none'">&times;</span>
            <h2>Editar</h2>
            <form id="form-edicao"><input type="hidden" id="edit-id">
                <div class="input-group" style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #fdfdfd;">
                    <label style="font-weight:bold; color:var(--primary)">Texto de Apoio (Opcional)</label>
                    <div style="display:flex; gap:10px;">
                        <select class="sel-texto-apoio" style="flex-grow:1;">
                            <option selected value="">-- Sem Texto de Apoio --</option>
                        </select>
                        <button type="button" class="btn-padrao" onclick="abrirModalTexto()">+ Novo Texto</button>
                    </div>
                    <div class="preview-texto-apoio" style="font-size:0.8em; color:#666; margin-top:5px; max-height:60px; overflow:hidden; font-style:italic;"></div>
                </div>
                <label>Enunciado:</label><textarea id="edit-enunciado" class="input-com-toolbar" rows="3" required
                    onfocus="showToolbar(this)"></textarea>
                <label>Imagem:</label>
                <div style="display:flex; align-items:center; gap:10px;"><input type="file" id="edit-imagem-file"
                        accept="image/*">
                    <div id="edit-img-preview-container"></div>
                </div><input type="hidden" id="edit-imagem-nome">
                <div class="filtro-grid">
                    <input type="text" id="edit-banca" list="lista-bancas" placeholder="Banca">
                    <input type="text" id="edit-instituicao" list="lista-instituicoes" placeholder="Institui√ß√£o">
                    <input type="number" id="edit-ano" placeholder="Ano">
                    <input type="text" id="edit-disciplina" list="lista-disciplinas" placeholder="Disciplina"
                        onchange="carregarAssuntos('edit')">
                </div>
                <div class="filtro-grid">
                    <input type="text" id="edit-assunto" list="lista-assuntos" placeholder="Assunto">
                    <select id="edit-dificuldade">
                        <option>F√°cil</option>
                        <option>M√©dio</option>
                        <option>Dif√≠cil</option>
                    </select>
                </div>
                <select id="edit-tipo" onchange="altTipo('edit')">
                    <option value="ME">M√∫ltipla</option>
                    <option value="CE">Certo/Errado</option>
                </select>
                <div id="edit-container-alt">
                    <div class="input-group"><span>A)</span><input type="text" id="edit-alt-a"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>B)</span><input type="text" id="edit-alt-b"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>C)</span><input type="text" id="edit-alt-c"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>D)</span><input type="text" id="edit-alt-d"
                            onfocus="showToolbar(this)"></div>
                    <div class="input-group"><span>E)</span><input type="text" id="edit-alt-e"
                            onfocus="showToolbar(this)"></div>
                </div><label>Gabarito:</label><select id="edit-gabarito"></select><button class="btn-acao"
                    style="background:#f39c12">Salvar</button>
            </form>
        </div>
    </div>

    <div id="modal-novo-texto" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="el('modal-novo-texto').style.display='none'">&times;</span>
            <h2>Cadastrar Novo Texto</h2>
            <input type="text" id="novo-texto-titulo" class="imp-input" placeholder="T√≠tulo / Identificador (Ex: Texto 1 - Aula 05)">
            <textarea id="novo-texto-conteudo" class="imp-textarea" rows="10" placeholder="Cole o texto aqui..."></textarea>
            <button class="btn-padrao" onclick="salvarNovoTextoApi()" style="width:100%; margin-top:10px;">Salvar Texto</button>
        </div>
    </div>

    <script src="assets/js/core.js"></script>
    <script src="assets/js/questoes.js"></script>
    <script src="assets/js/estudo.js"></script>
</body>

</html>